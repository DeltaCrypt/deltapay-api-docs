{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Introduction","text":""},{"location":"#abstract","title":"Abstract","text":"<p>This document acts as a guide for DeltaPay\u2019s open API. It documents the features we expect will be most commonly used by our clients and partners.</p> <p>We firmly believe in open and accessible APIs that anyone can access without additional charges or fees. For this reason, we have decided to make the entire REST interface used by our mobile application accessible to the public. This also means that the API is significantly more extensive than the features highlighted in this document. For a complete list of the endpoints available, please visit:</p> <ul> <li>https://api.dev.deltacrypt.net/docs</li> <li>https://api.prod.deltacrypt.net/docs</li> </ul> <p>to view the auto-generated swagger documentation online for our respective development, staging, and production environments.</p>"},{"location":"#contributing-to-the-documentation","title":"Contributing to the Documentation","text":"<p>The source code from which this documentation is generated is hosted on GitHub. Please don't hesitate to raise issues or pull requests. We are dedicated to imporoving the documentation and any feedback / input is always appreciated! </p>"},{"location":"#environments","title":"Environments","text":"<p>DeltaPay currently offers two mutually exclusive environments: development and production.</p> <p>The development environment is designed for testing new features and changes that have not yet been published to production. It mirrors the production setup but does not need to meet regulatory requirements, as it is solely for testing purposes.</p> <p>The production environment is where real transactions take place. API keys for production access are issued after testing in development and staging environments, ensuring that integrations meet all necessary security and compliance standards.</p> <p>We highly recommend testing in development first before connecting to the production endpoints.</p>"},{"location":"#api-request-guidelines","title":"API Request Guidelines","text":"<p>Unless otherwise specified:</p> <ul> <li>POST requests expect JSON-encoded data.</li> <li>GET and DELETE requests expect URL-encoded data.</li> </ul> <p>All endpoints will return a status code 200 (OK) if no exceptions occur. Other relevant response codes include:</p> <ul> <li>404 - Not Found: The requested resource (e.g., a user) does not exist.</li> <li>401 - Unauthorized: See Authentication Errors.</li> <li>500 - Internal Server Error: Please contact DeltaPay.</li> </ul> <p>All endpoints return JSON-encoded data. If no data is returned, the response will be a generic success object:</p> <pre><code>{\n  \"success\": true\n}\n</code></pre> <p>Unless otherwise specified, this is the default response format.</p>"},{"location":"common_usecases/b2c/","title":"Scenario","text":"<p>Disbursing funds to a customer\u2019s (or another business\u2019) DeltaPay account follows this process:</p> <ol> <li>(Optional) Check whether the transaction is possible using a preview endpoint</li> <li>Send and sign the transfer in a single call (recommended)</li> <li>(Optional) Check the blockchain transaction status</li> <li>Receive a callback when the transaction status changes (IPN)</li> <li>Query the transaction on the DeltaPay side</li> </ol>"},{"location":"common_usecases/b2c/#recommended-flow","title":"Recommended flow","text":"<p>Use <code>POST /transaction/send-transfer</code>. This endpoint:</p> <ul> <li>creates the DeltaPay transaction</li> <li>builds the underlying blockchain transaction</li> <li>signs it using the private key you provide</li> <li>submits it to the blockchain</li> </ul> <p>The response contains a <code>tracking_id</code> corresponding to the <code>blockchain_transaction_id</code> of the transaction that was just created.</p>"},{"location":"common_usecases/b2c/#manual-raw-transaction-flow-advanced","title":"Manual / raw-transaction flow (advanced)","text":"<p>If you cannot send the private key, you can use the raw-transaction flow:</p> <ol> <li>Call <code>POST /transaction/initiate-transfer</code> to obtain a <code>raw_transaction</code></li> <li>Sign it on your side</li> <li>Submit the signed bytes using <code>POST /blockchain/signed-transaction</code></li> </ol> <p>This is only needed when your key-management requirements prevent you from using the recommended flow. Details of signing and submitting raw transactions are described in the blockchain section.</p>"},{"location":"common_usecases/b2c/#is-it-safe-to-send-the-private-key","title":"Is it Safe to Send the Private Key?","text":"<p>In the recommended flow, the private key is included in the HTTPS request body. The following points describe how the key is handled on DeltaPay\u2019s side:</p> <ul> <li>Transport uses TLS, so the private key is protected by the same communication channel that is normally used to send API keys, passwords, and other sensitive credentials.</li> <li>The key is used only to sign the transaction in memory and is not stored in DeltaPay\u2019s database or logs.</li> <li>Requests should be made from your backend system. The private key should not be exposed to client-side environments.</li> <li>The private key should be treated like any other sensitive secret on your side (for example, avoid logging it and keep it in a secret-management system).</li> </ul> <p>Using this flow effectively shifts the security boundary from the public\u2013private key pair itself to the security of the channel and environment through which the private key is transmitted. This is the same model used when sending API keys, authentication tokens, or passwords to a backend service.</p> <p>If your policies do not allow the private key to leave your infrastructure, use the manual flow.</p>"},{"location":"common_usecases/b2c/#transactions-vs-blockchain-transactions","title":"Transactions vs Blockchain Transactions","text":"<p>DeltaPay distinguishes between:</p> <p>DeltaPay transactions (platform-level)</p> <ul> <li>Represent business events like transfers, deposits, withdrawals</li> <li>Stored in the DeltaPay database with a <code>transaction_id</code> and business-level status (pending, initiated, approved, failed, succeeded, and reversed)</li> </ul> <p>Blockchain transactions (on-chain)</p> <ul> <li>Ethereum transactions that interact with smart contracts on our permissioned chain</li> <li>Identified by a <code>blockchain_transaction_id</code> and have their own status (pending, failed, and succeeded)</li> </ul> <p>A single DeltaPay transaction may involve multiple blockchain transactions (for example: initiate, approve, and finalise).</p> <p>When a blockchain transaction fails, the underlying error comes directly from the smart contract. These errors are per blockchain transaction, not per DeltaPay transaction. If you want to understand exactly why something failed on-chain, you can inspect the blockchain error using:</p> <ul> <li><code>GET /blockchain/transaction-status</code></li> <li><code>GET /blockchain/transaction/error-message</code></li> </ul> <p>This information is primarily useful for debugging or for communicating more detailed error context to the end user. In normal operation, the preview endpoints should prevent the vast majority of attempts that would result in an on-chain failure. The blockchain error endpoints are therefore mostly relevant for edge cases, such as race conditions (e.g. limits or balances changing after the preview call). For more information on how to interact with the blockchain, please refer to this section.</p>"},{"location":"common_usecases/b2c/#check-preview-transaction","title":"Check / Preview Transaction","text":"<p>Before sending money, it is advisable to preview whether the transaction is likely to succeed. This avoids unnecessary polling and simplifies error handling.</p> <p>A transaction may fail for several reasons:</p> <ul> <li>Insufficient account balance</li> <li>Limits exceeded (daily / monthly / wallet-level)</li> <li>Transaction amount too low</li> <li>Account suspended or closed</li> <li>User not whitelisted</li> </ul> <p>Note: Insufficient spending allowances (daily spending limits) do not prevent the transaction from being created. In such cases the transaction will be created but require approval, which is reflected in its status when you query it or receive callbacks.</p>"},{"location":"common_usecases/b2c/#transfer-preview","title":"Transfer preview","text":"<p><code>GET /transaction/transfer-preview</code></p> <p>This endpoint returns all information needed to decide whether a transfer should be initiated, without actually creating a transaction.</p> <p>Request Parameters</p> <ul> <li><code>sender_wallet_address</code>: string</li> <li><code>transaction_type</code>: string</li> <li><code>amount</code>: number</li> <li><code>recipient_phone_country_dialcode</code>: Optional[string]</li> <li><code>recipient_phone_number</code>: Optional[string]</li> <li><code>recipient_username</code>: Optional[string]</li> <li><code>recipient_business_account_id</code>: Optional[int]</li> </ul> <p>The <code>sender_wallet_address</code> must be linked to an account.</p> <p>The recipient can be identified using (<code>recipient_phone_country_dialcode</code> + <code>recipient_phone_number</code>), <code>recipient_username</code>, or a <code>recipient_business_account_id</code>. For personal accounts, use either the phone number or the username; for business accounts, use the business account ID.</p>"},{"location":"common_usecases/b2c/#response-structure","title":"Response structure","text":"<p>The endpoint always returns the same top-level fields:</p> <ul> <li><code>transaction_possible</code></li> <li><code>fee_info</code></li> <li><code>cashback_possible</code></li> <li><code>recipient_username</code></li> <li><code>recipient_legal_name</code></li> <li><code>recipient_business_account_info</code></li> <li><code>sender_tills</code></li> <li><code>recipient_tills</code></li> </ul> <p>What changes is which of these contain data:</p> <ul> <li> <p><code>transaction_possible.possible</code> is always present.</p> </li> <li> <p>If true, it includes <code>sender_account_id</code>.</p> </li> <li>If false, it includes <code>error_name</code> and <code>error_arguments</code> describing why the transfer cannot proceed.</li> <li><code>fee_info</code> is populated when the fee can be calculated. It is <code>null</code> if the transaction is not possible.</li> <li><code>cashback_possible</code> describes whether cashback can be applied and, if not, why. It is <code>null</code> when cashback is not evaluated (for example, when the transaction itself is not possible). </li> <li>Recipient fields and tills arrays are filled when the recipient and available tills can be resolved; otherwise they are <code>null</code> or empty arrays.</li> </ul> <p>This gives you enough information to decide whether to proceed and to show meaningful messages to the user before actually creating a transaction.</p> <p>Example response structure (transaction possible):</p> <pre><code>{\n  \"transaction_possible\": {\n    \"possible\": true,\n    \"sender_account_id\": 26,\n    \"fee\": 0.0\n  },\n  \"fee_info\": {\n    \"fee\": 0.0,\n    \"cashback_received\": null\n  },\n  \"cashback_possible\": {\n    \"possible\": false,\n    \"error_name\": \"ERR_ACCOUNT_TYPE_REQUIRED\",\n    \"error_arguments\": [\n      \"83\",\n      \"['3']\",\n      \"1\"\n    ]\n  },\n  \"recipient_username\": \"dayni\",\n  \"recipient_legal_name\": \"D. Test\",\n  \"recipient_business_account_info\": null,\n  \"sender_tills\": [\n    {\n      \"till_name\": \"mulatill\",\n      \"till_id\": 40,\n      \"active\": true,\n      \"deactivation_time\": null\n    }\n  ],\n  \"recipient_tills\": []\n}\n</code></pre> <p>Example response structure (transaction not possible):</p> <pre><code>{\n  \"transaction_possible\": {\n    \"possible\": false,\n    \"error_name\": \"Sender wallet address does not belong to an active account or user\",\n    \"error_arguments\": [\n      \"0xe1a5e0d853a2620ffac9d15fe9e5fd8d19370ca6\"\n    ]\n  },\n  \"fee_info\": null,\n  \"cashback_possible\": null,\n  \"recipient_username\": null,\n  \"recipient_legal_name\": null,\n  \"recipient_business_account_info\": null,\n  \"sender_tills\": [],\n  \"recipient_tills\": []\n}\n</code></pre>"},{"location":"common_usecases/b2c/#race-conditions-and-limitations","title":"Race Conditions and Limitations","text":"<p>A \u201cpossible = true\u201d preview is advisory, but not a strict guarantee that the transaction will in fact settle successfully, since, among other reasons:</p> <ul> <li>The user may send/receive other funds after your preview.</li> <li>The user's KYC type may change, affecting ther limits</li> <li>Their account status can change (e.g. suspended).</li> </ul> <p>Example race:</p> <ol> <li>You call <code>GET /transaction/transfer-preview</code> and receive <code>\"possible\": true</code>.</li> <li>The user performs additional activity (e.g. another large transfer).</li> <li>When you actually send the transfer, it fails or requires approval due to limits being exceeded.</li> </ol> <p>Note: Similar preview / possible endpoints exist for other flows (deposits, withdrawals). Refer to the corresponding sections and the Swagger docs for details.</p>"},{"location":"common_usecases/b2c/#send-and-sign-transaction","title":"Send and Sign Transaction","text":"<p>For most server-side integrations, you should use:</p> <p><code>POST /transaction/send-transfer</code></p> <p>This endpoint:</p> <ol> <li>Validates the request and checks basic constraints</li> <li>Creates the DeltaPay transaction</li> <li>Constructs the underlying raw blockchain transaction</li> <li>Signs it using the private key you provide</li> <li>Submits it to the blockchain</li> <li>Returns a tracking ID you can later use to correlate callbacks and queries</li> </ol> <p>Request Parameters</p> <p>The body closely mirrors <code>POST /transaction/initiate-transfer</code>, replacing the <code>sender_wallet_address</code> with the <code>private_key</code> field.</p> <ul> <li><code>private_key</code>: string</li> <li><code>amount</code>: number</li> <li><code>note</code>: Optional[string]</li> <li><code>metadata</code>: Optional[string]</li> <li><code>sender_till_id</code>: Optional[int]</li> <li><code>recipient_phone_country_dialcode</code>: string</li> <li><code>recipient_phone_number</code>: string</li> <li><code>transaction_type</code>: string (A list of valid transaction types can be retrieved here)</li> <li><code>source_of_funds</code>: Optional[string]</li> </ul> <p>As for similar endpoints:</p> <p>The <code>private_key</code> must be linked to an account.</p> <p>The <code>metadata</code> is an optional free-form string (e.g., JSON-encoded string with order info).</p> <p><code>source_of_funds</code> must only be provided for transaction with <code>transaction_type == \"cash_deposit\"</code>.</p> <p>Example Response</p> <pre><code>{\n  \"success\": true,\n  \"tracking_id\": \"420\"\n}\n</code></pre> <p>The <code>tracking_id</code> corresponding to the <code>blockchain_transaction_id</code> of the transaction that was just created and can be used to poll its status, see Get Blockchain Transaction Status.</p>"},{"location":"common_usecases/b2c/#manual-raw-transaction-flow","title":"Manual / Raw-Transaction Flow","text":"<p>If you cannot send the private key to DeltaPay, or you maintain your own signing infrastructure, you can use the more general raw-transaction flow documented here and in the dedicated Blockchain Interactions section.</p> <p><code>POST /transaction/initiate-transfer</code></p> <p>Request Parameters</p> <p>The body closely mirrors <code>POST /transaction/send-transfer</code>, replacing the <code>private_key</code> with the <code>sender_wallet_address</code> field. For a detailled explanation of the fields, refer to the above section.</p> <ul> <li><code>sender_wallet_address</code>: string</li> <li><code>amount</code>: number</li> <li><code>note</code>: Optional[string]</li> <li><code>sender_till_id</code>: Optional[int]</li> <li><code>recipient_username</code>: Optional[string]</li> <li><code>recipient_account_id</code>: Optional[int]</li> <li><code>recipient_till_id</code>: Optional[int]</li> <li><code>transaction_type</code>: string</li> <li><code>source_of_funds</code>: Optional[string]</li> </ul> <p>Example Response</p> <pre><code>{\n  \"raw_transaction\": {\n    \"from\": \"0x7E5F4552091A69125d5DfCb7b8C2659029395Bdf\",\n    \"to\": \"0x52A816dB82157a5f4b2c4Fb5Be745AC4103Db674\",\n    \"nonce\": 0,\n    \"chainId\": \"1337\",\n    \"data\": \"0x21d43aaf000000000.....\",\n    \"gasLimit\": \"0x1ffffffffffffe\",\n    \"gasPrice\": 0,\n    \"type\": 0\n  },\n  \"topic\": \"initiate-transfer\",\n  \"transaction_id\": 166\n}\n</code></pre> <p>From this point onwards, you have a <code>raw_transaction</code> object that must be</p> <ol> <li>Signed with the private key corresponding to <code>sender_wallet_address</code>.</li> <li>Submitted using <code>POST /blockchain/signed-transaction</code>.</li> </ol> <p>Please refer to the Blockchain Interaction section for language-specific signing examples as well as more details regarding the submission and tracking of blockchain transactions.</p> <p>Here is a clean, consistent section you can append at the end. No fluff, no ChatGPT tone \u2014 same documentation voice as the rest.</p>"},{"location":"common_usecases/b2c/#tracking-the-transaction","title":"Tracking the Transaction","text":"<p>Once the transfer request has been submitted (either via the recommended flow or the raw-transaction flow), the transaction must be tracked asynchronously. A successful response from <code>POST /transaction/send-transfer</code> or <code>POST /blockchain/signed-transaction</code> only confirms that the blockchain transaction has been accepted into the transaction pool. It does not guarantee that the transaction will succeed. It may still fail on-chain, or the resulting DeltaPay transaction may require approval.</p> <p>Tracking can be done using either:</p> <ul> <li>(recommended) A unique value placed in the <code>metadata</code> field that you can use to correlate events on your side</li> <li>the <code>transaction_id</code> returned by the endpoint</li> </ul> <p>As with C2B (Collections), there are two mechanisms for tracking status:</p> <ol> <li> <p>Polling Query the transaction status until it reaches a final state.</p> </li> <li> <p>IPNs (Callbacks) Receive asynchronous notifications when the transaction state changes.    The same considerations and behaviour as described in the Collections documentation apply here.</p> </li> </ol> <p>For details on polling intervals, callback handling, idempotency, and retry logic, refer to the corresponding sections in the C2B (Collections) documentation.</p>"},{"location":"common_usecases/blockchain/","title":"Interacting with the Blockchain","text":"<p>The process for interacting with the blockchain is consistent across all transaction types:</p> <ol> <li>Get the raw Ethereum transaction object.</li> <li>Sign the raw blockchain transaction.</li> <li>Submit the signed blockchain transaction.</li> <li>Query the blockchain transaction (optional).</li> </ol> <p>In some cases, the endpoint returning the raw transaction also performs additional setup (for example, <code>/transaction/initiate-deposit</code> both creates the database entry and prepares the blockchain transaction).</p> <p>For frequently used operations, shortcut endpoints are provided. These endpoints handle signing internally if the private key is supplied, reducing the process to a single HTTP request (e.g. <code>POST /transaction/send-transfer</code>).</p> <p>Note: When using endpoints that accept a private key directly, security relies on standard TLS encryption. The private keys sent in this way are never stored on DeltaPay servers.</p>"},{"location":"common_usecases/blockchain/#difference-between-transaction-and-blockchain-transaction","title":"Difference Between Transaction and Blockchain Transaction","text":"<p>A transaction in DeltaPay refers to the high-level payment record tracked in the DeltaPay database (for example, a deposit or transfer). A blockchain transaction is the corresponding on-chain event that executes the transfer of tokens or smart-contract function.</p> <p>One DeltaPay transaction may involve multiple blockchain transactions \u2014 for example, a deposit could include both an initialisation and a finalisation transaction. Blockchain-level errors are reflected separately via the blockchain transaction status and error-message endpoints.</p>"},{"location":"common_usecases/blockchain/#1-getting-the-raw-transaction","title":"1. Getting the Raw Transaction","text":"<p>The raw transaction describes what will be executed on the blockchain. It includes fields such as <code>to</code>, <code>data</code>, <code>chainId</code>, <code>gasLimit</code>, and <code>nonce</code>.</p> <p>Example response structure:</p> <pre><code>{\n  \"raw_transaction\": {\n    \"from\": \"0x7E5F4552091A69125d5DfCb7b8C2659029395Bdf\",\n    \"to\": \"0x52A816dB82157a5f4b2c4Fb5Be745AC4103Db674\",\n    \"nonce\": 0,\n    \"chainId\": \"1337\",\n    \"data\": \"0x21d43aaf000000000.....\",\n    \"gasLimit\": \"0x1ffffffffffffe\",\n    \"gasPrice\": 0,\n    \"type\": 0\n  },\n  \"topic\": \"finalise-transfer\"\n}\n</code></pre> <p>You can now sign the <code>raw_transaction</code> using any Ethereum-compatible library. Once signed, it should be submitted to the blockchain using the returned <code>topic</code>.</p>"},{"location":"common_usecases/blockchain/#2-signing-the-raw-transaction","title":"2. Signing the Raw Transaction","text":"<p>Signing transforms the unsigned JSON transaction into a signed, broadcastable payload. The <code>raw_transaction</code> must be signed using the private key corresponding to the <code>sender_wallet_address</code>. Any Ethereum-compatible signing library can be used.</p>"},{"location":"common_usecases/blockchain/#recommended-libraries","title":"Recommended Libraries","text":"<p>JavaScript / TypeScript</p> <ul> <li>ethers.js</li> <li>web3.js</li> </ul> <p>Python</p> <ul> <li>web3.py</li> <li>eth-account</li> </ul> <p>Other Supported Languages</p> <ul> <li>Go \u2192 go-ethereum</li> <li>Java \u2192 web3j</li> <li>C# \u2192 Nethereum</li> <li>Swift \u2192 web3.swift</li> <li>Rust \u2192 ethers-rs</li> </ul> <p>Below are short code examples for the most common environments. The full runnable examples (including API setup, error handling, and polling) are available in the Python Example and TypeScript Example sections.</p>"},{"location":"common_usecases/blockchain/#python-example-using-web3py","title":"Python Example (using <code>web3.py</code>)","text":"<pre><code>from web3 import Web3\n\n# raw_transaction is what you received from the initiate endpoint\ndef translate_transaction(raw_transaction):\n    raw_transaction['chainId'] = int(raw_transaction['chainId'])\n    raw_transaction['gas'] = int(raw_transaction['gasLimit'], 16)\n    del raw_transaction['gasLimit']\n    raw_transaction['gasPrice'] = int(raw_transaction['gasPrice'])\n    if raw_transaction.get('type') == 0:\n        del raw_transaction['type']\n    return raw_transaction\n\nw3 = Web3()\nwallet = w3.eth.account.from_key(\"YOUR_PRIVATE_KEY_HERE\")\n\nsigned = wallet.sign_transaction(translate_transaction(raw_transaction))\nsigned_transaction = \"0x\" + signed.raw_transaction.hex()\n\nprint(\"Signed Transaction:\", signed_transaction)\n</code></pre> <p>This produces a hex-encoded signed transaction string that you can now submit to the blockchain.</p>"},{"location":"common_usecases/blockchain/#javascript-typescript-example-using-ethersjs","title":"JavaScript / TypeScript Example (using <code>ethers.js</code>)","text":"<pre><code>import { ethers } from \"ethers\";\n\n// raw_transaction is what you received from the initiate endpoint\nconst wallet = new ethers.Wallet(\"YOUR_PRIVATE_KEY_HERE\");\nconst signedTransaction = await wallet.signTransaction(raw_transaction);\n\nconsole.log(\"Signed Transaction:\", signedTransaction);\n</code></pre> <p>Both examples generate a <code>signedTransaction</code> string which should be sent to the <code>/blockchain/signed-transaction</code> endpoint, together with the <code>topic</code> value returned earlier.</p>"},{"location":"common_usecases/blockchain/#3-submitting-the-signed-transaction","title":"3. Submitting the Signed Transaction","text":"<p><code>POST /blockchain/signed-transaction</code></p> <p>Request Parameters</p> <ul> <li><code>transaction_bytes</code>: string \u2014 the signed transaction hex string</li> <li><code>topic</code>: string \u2014 the topic returned by the raw transaction endpoint</li> </ul> <p>Example Request</p> <pre><code>{\n  \"transaction_bytes\": \"0xf86b80843b9aca0082520894...\",\n  \"topic\": \"finalise-transfer\"\n}\n</code></pre> <p>Example Response</p> <pre><code>{\n  \"success\": true,\n  \"tracking_id\": 214\n}\n</code></pre> <p>Use the <code>tracking_id</code> to query blockchain transaction status or correlate with internal transaction logs.</p>"},{"location":"common_usecases/blockchain/#4-querying-blockchain-transaction-status","title":"4. Querying Blockchain Transaction Status","text":"<p>You can query the blockchain transaction status directly, or rely on the IPN callback to notify your system of updates.</p>"},{"location":"common_usecases/blockchain/#get-blockchain-transaction-status","title":"Get Blockchain Transaction Status","text":"<p><code>GET /blockchain/transaction-status</code></p> <p>Request Parameters</p> <ul> <li><code>transaction_id</code>: string \u2014 The blockchain transaction id</li> </ul> <p>Example Response</p> <pre><code>{\n  \"blockchain_transaction_status\": \"succeeded\"\n}\n</code></pre>"},{"location":"common_usecases/blockchain/#get-blockchain-transaction-error-message","title":"Get Blockchain Transaction Error Message","text":"<p><code>GET /blockchain/transaction/error-message</code></p> <p>If the transaction failed, this endpoint provides the decoded smart-contract error for debugging.</p> <p>Example Response</p> <pre><code>{\n  \"error_message\": \"{\\n  \\\"name\\\": \\\"ERR_USER_NOT_WHITELISTED\\\",\\n  \\\"args\\\": [\\\"0x2B5AD5c4795c026514f8317c7a215E218DcCD6cF\\\"]\\n}\"\n}\n</code></pre>"},{"location":"common_usecases/c2b/","title":"Scenario","text":"<p>The customer pays for a service using DeltaPay. The service provider is notified of updates regarding the transaction, such as the success or failure of the payment.</p> <p>For example, the process of paying for an item online might look like this:</p>"},{"location":"common_usecases/c2b/#using-payment-requests-recommended","title":"Using payment requests (recommended)","text":"<ol> <li>The website asks for the user's phone number or username used on DeltaPay. This information may also be linked to the user's profile.</li> <li>The website sends a payment request to the user including at least the amount, recipient account, and reference (see Payment Requests). The website may optionally specify a timeout within which the payment request must be accepted.</li> <li>The user either accepts or rejects the payment request. They can only accept requests where the resulting transaction would be possible.</li> <li>Once the transaction settles, the IPN (Instant Payment Notification) is sent to the registered callback(s), notifying the seller of an update regarding the payment.</li> </ol>"},{"location":"common_usecases/c2b/#using-qr-codes","title":"Using QR codes","text":"<ol> <li>The website generates a payment QR code encoding the amount, recipient, and reference (see QR Code Specification).</li> <li>The user scans the QR code and the information is prefilled in the DeltaPay app.</li> <li>The user approves and sends the transaction.</li> <li>The IPN is sent to the registered callback(s), notifying the seller of an update regarding the payment.</li> </ol> <p>Note: We are working on supporting deep-links as an alternative to QR code or manual input.</p>"},{"location":"common_usecases/c2b/#payment-reference","title":"Payment reference","text":"<p>There are two options for encoding a payment reference:</p> <ul> <li>notes: can be entered and edited by the user (max 200 characters)</li> <li>metadata: is not shown to the user</li> </ul> <p>Both are arbitrary strings that can be included in the QR code and will be picked up by the DeltaPay app.</p>"},{"location":"common_usecases/c2b/#instant-payment-notification-ipn","title":"Instant Payment Notification (IPN)","text":"<p>The IPN callback is triggered for all updates to transaction statuses involving either the sender or recipient account. For more detailed information about callbacks, refer to  this section.</p> <p>Callback URL format:</p> <pre><code>base URL + /transaction/ipn\n</code></pre>"},{"location":"common_usecases/c2b/#example-payload","title":"Example payload","text":"<pre><code>{\n  \"transaction_id\": 398,\n  \"transaction_type\": \"rent\",\n  \"transaction_status\": \"succeeded\",\n  \"initialisation_time\": \"2024-10-26T20:43:15.515122\",\n  \"settled_time\": \"2024-10-26T20:43:21.639949\",\n  \"note\": \"hello\",\n  \"metadata\": null,\n  \"source_of_funds\": \"\",\n  \"bank_account\": null,\n  \"sender_account_id\": 1014,\n  \"sender_account_name\": \"New 3\",\n  \"sender_name\": \"DeltaPay\",\n  \"sender_till_name\": null,\n  \"sender_phone_country_dialcode\": null,\n  \"sender_phone_number\": null,\n  \"recipient_account_id\": 1001,\n  \"recipient_account_name\": \"Personal\",\n  \"recipient_name\": \"adrian\",\n  \"recipient_till_name\": null,\n  \"recipient_phone_country_dialcode\": null,\n  \"recipient_phone_number\": null,\n  \"amount\": 6,\n  \"cashback_received\": 0,\n  \"cashback_spent\": 0,\n  \"fee\": 0,\n  \"commission_amount\": 0,\n  \"signature\": \"VMDnRnvRJVvTHu9HNgjsIWhlXOd1bYkPPsp23y3cVl3Tn7Zzlg7AJAy5654fld5U7XrhQbDd3Mj684WcFnpbRgeiRIQDBtEL2eLKO7ZHjC/jg0n0zVjE2TRfPACuiXsmR/pJG+8hPmABBqThGj2hE5SEBFD4WSlzgAcLA0ZxZWvtDu2FAUpN1B+FtMfCmxa4DmH/GPtVs+80c8hHX3KGt35iaBrwD66vhdEUrSaYEgFooRmS3K9dm+neOPHgIfXG60sv03Ru5EZDMKNQvalUlCdLUerjr3eoZPs4DkYZj2FhwBZOJPBh6SDmCgSUsKclvepd0hExXNsRwOsKsxDcuQ==\"\n}\n</code></pre>"},{"location":"common_usecases/c2b/#payment-request-status-updates","title":"Payment Request Status Updates","text":"<p>This callback is triggered whenever a payment request status changes for any request where the recipient account is the one associated with the registered callback. For more detailed information about callbacks, refer to  this section.</p> <p>Callback URL format:</p> <pre><code>base URL + /payment-request/update\n</code></pre>"},{"location":"common_usecases/c2b/#example-payload_1","title":"Example payload","text":"<pre><code>{\n  \"payment_request_id\": 191,\n  \"payment_request_status\": \"rejected\",\n  \"account_id\": 14,\n  \"transaction_type\": \"eating_out\",\n  \"transaction_id\": null,\n  \"transaction_status\": null,\n  \"till_name\": null,\n  \"till_id\": null,\n  \"note\": \"Peter ist ein netter Mensch\",\n  \"metadata\": null,\n  \"request_time\": \"2025-09-19T18:23:40.577917\",\n  \"timeout\": null,\n  \"sender_user_id\": null,\n  \"sender_legal_entity_id\": 2,\n  \"recipient_user_id\": 76,\n  \"sender_name\": \"MinenhleGrocery\",\n  \"recipient_name\": \"Sifiso Dlamini (@philipp20251)\",\n  \"amount\": 22,\n  \"signature\": \"iNUd7WxPOlYXdIsjwWi2MGHoYuAKwVvSl5TBQCXzduW5G0Wk8NYTffRuenJmh33Q3WW3sjDme4lfX376EmnHcynZMnN0IJDY0ZF6+KGQObWa22teeRw5RVBzuzosyY5rHzOz8w/JhZII8b/86qPLvYGcgfYU3eClbnJ3nAYdD5NxYDVFgAYo0/WrvqVgGsx+QVpa/ofY+ylkBpraiDGugPS4DOJM85Xl40fwCRq7QHbb8gLpYUFm4Ny6hR+iKr6TPrzIN54arQRjWbgOMSwHUv1QEAGfH+CW66RIkXgj8PqaUGYdtD57aXwa3Lo8IMaq1SJ/8chvaWV4I2rE3QsNPA==\"\n}\n</code></pre>"},{"location":"common_usecases/c2b/#fallback-mechanisms","title":"Fallback mechanisms","text":"<p>Callbacks are the most efficient way to receive real-time updates, but they rely on your endpoint being continuously available. If a callback cannot be delivered, it will currently not be retried.</p> <p>In such cases, clients can use polling as a fallback:</p> <ul> <li>For transactions: use <code>GET /full-transaction/from-id</code> or <code>GET /full-transaction/from-metadata</code>.</li> <li>For payment requests: use <code>GET /payment-request/from-id</code> or <code>GET payment-request/from-metadata</code>.</li> </ul> <p>This ensures that your system can recover state even if a callback was missed.</p>"},{"location":"common_usecases/payment_requests/","title":"Payment Request API","text":"<p>The Payment Request API allows for the creation and management of requests for payments.</p> <p>The recipient of the payment request (PR) receives a push notification and the PR is displayed on their home screen until either accepted or rejected. </p> <p>PRs can only be sent to individual users. When accepting the PR, the user can chose the account from which to pay.</p>"},{"location":"common_usecases/payment_requests/#creating-a-payment-request","title":"Creating a payment request","text":"<p><code>POST /payment-request/create</code></p> <p>Description: Requesting a payment from a user. The user is specified either by their username or the phone number they used to sign up with DeltaPay.</p> <p>Request Parameters</p> <ul> <li><code>account_id</code>: int</li> <li><code>amount</code>: number</li> <li><code>transaction_type</code>: string  (A list of valid transaction types can be retrieved here)</li> <li><code>till_id</code>: Optional[int]</li> <li><code>note</code>: Optional[string]</li> <li><code>metadata</code>: Optional[string]</li> <li><code>phone_country_dialcode</code>: Optional[string] (do not inlcude a '+')</li> <li><code>phone_number</code>: Optional[string]</li> <li><code>username</code>: Optional[string]</li> </ul> <p>The <code>account_id</code> specifies the the recipient account that the payment is being requested into.</p> <p>Either <code>username</code> or both <code>phone_country_dialcode</code> and <code>phone_number</code> must be provided.</p> <p>The <code>metadata</code> is an optional free-form string (e.g., JSON-encoded string with order info).</p> <p>Required Permissions</p> <p>The caller must have the <code>create_payment_request</code> permission, either generally or specifically for the account.</p>"},{"location":"common_usecases/payment_requests/#viewing-payment-requests","title":"Viewing Payment Requests","text":"<p>There are two ways to view a payment request: either by using the <code>payment_request_id</code> returned from the <code>POST /payment-request/create</code> endpoint, or by using the <code>metadata</code> specified when the request was created.</p> <p>When using <code>metadata</code>, please ensure that it can reasonably be assumed to be unique. If multiple payment requests share the same metadata, the most recent one will be returned.</p> <ul> <li> <p><code>GET /payment-requests/from-id</code></p> </li> <li> <p><code>GET /payment-requests/from-metadata</code></p> </li> </ul> <p>This endpoint returns either 404 or the paymnent request. The sender of the PR is returned as a</p> <ul> <li>user, if the account is a personal account</li> <li>legal entity, if the account is a business account</li> </ul> <p>Request Parameters</p> <p>either</p> <ul> <li><code>payment_request_id</code>: int</li> </ul> <p>or</p> <ul> <li><code>metadata</code>: string</li> </ul> <p>respectively</p> <p>Required Permissions</p> <p>The caller must have the <code>view_payment_requests</code> permission, either generally or specifically for the user or legal entity of either the sender or recipient of the payment request.</p>"},{"location":"common_usecases/payment_requests/#viewing-incoming-payment-requests","title":"Viewing Incoming Payment Requests","text":"<p><code>GET /user/payment-requests/incoming</code></p> <p>This endpoint returns a list of PRs that have been sent to the specified user. The sender of the PR is returned as a</p> <ul> <li>user, if the account is a personal account</li> <li>legal entity, if the account is a business account</li> </ul> <p>Request Parameters</p> <ul> <li><code>user_id</code>: int</li> <li><code>status</code>: string</li> </ul> <p>Required Permissions</p> <p>The caller must have the <code>view_payment_requests</code> permission, either generally or specifically for the user.</p>"},{"location":"common_usecases/payment_requests/#viewing-outgoing-payment-requests","title":"Viewing Outgoing Payment Requests","text":"<p>There are two endpoints for getting RPs outgoing from a user and a legal entity, respectively.</p> <p><code>GET /user/payment-requests/outgoing</code></p> <p>This endpoint returns all PRs that request funds to be sent to an account the user is linked to.</p> <p>Request Parameters</p> <ul> <li><code>user_id</code>: int</li> <li><code>status</code>: string</li> </ul> <p>Required Permissions</p> <p>The caller must have the <code>view_payment_requests</code> permission, either generally or specifically for the user.</p> <p><code>GET /legal-entity/payment-requests/outgoing</code></p> <p>This endpoint returns all PRs that request funds to be sent to an account the legal entity is linked to.</p> <p>Request Parameters</p> <ul> <li><code>legal_entity_id</code>: int</li> <li><code>status</code>: string</li> </ul> <p>Required Permissions</p> <p>The caller must have the <code>view_payment_requests</code> permission, either generally or specifically for the legal entity. </p>"},{"location":"common_usecases/payment_requests/#payment-request-state","title":"Payment Request state","text":"<p>A PR can be in one of the following states:</p> <ul> <li>pending</li> <li>cancelled</li> <li>rejected</li> <li>approved</li> <li>succeeded</li> <li>failed</li> </ul> <p>When a PR is created, it will be in the pending state, from there on the following actions trigger the respective state changes:</p> Action State Change sender cancels pending \u2192 cancelled recipinet rejects pending \u2192 rejected recipient approves pending \u2192 approved transaction succeeds approved \u2192 succeeded transaction fails approved \u2192 failed <p>No other state changes are possible; e.g. pending \u2192 succeeded can never occur, as it </p>"},{"location":"common_usecases/qr_code/","title":"DeltaPay QR Code JSON Specification","text":"<p>This document describes the JSON payload encoded in DeltaPay QR codes. Any QR code library that accepts a string input can generate a DeltaPay QR code.</p>"},{"location":"common_usecases/qr_code/#1-overview","title":"1. Overview","text":"<ul> <li>Payload is a plain JSON object.</li> <li>Null values should be omitted before encoding.</li> <li>Supports any QR library (e.g., <code>qr_flutter</code>, <code>flutter_qr_reader</code>, <code>qrcode</code> in JavaScript, etc.).</li> </ul>"},{"location":"common_usecases/qr_code/#2-json-structure","title":"2. JSON Structure","text":"Field Type Description <code>username</code> String Recipient's username. <code>account_id</code> Integer Recipient's numeric account ID. <code>amount</code> Number Transaction amount (SZL). <code>transaction_type</code> String A list of valid transaction types can be retrieved here. <code>till_id</code> Integer Merchant's till terminal ID. <code>note</code> String Optional note that is visible to the customer. <code>metadata</code> String Optional free-form metadata (can be JSON-encoded string if needed). Not visible to the customer. <p>Note: Either the <code>username</code> or <code>account_id</code> is required. If both are provided, the <code>account_id</code> takes precedence but the payment will marked as being received \"through\" this user. E.g., if the <code>account_id</code> references a business account and the user generating the QR code (and accepting the payment) is linked to the business account as an employee, he will only be able to see the incoming payment in his payment history if the transaction has been marked to be accepted by him. </p>"},{"location":"common_usecases/qr_code/#3-example-payload","title":"3. Example Payload","text":"<pre><code>{\n  \"username\": \"sifiso\",\n  \"account_id\": 42,\n  \"amount\": 50.0,\n  \"transaction_type\": \"taxes\",\n  \"till_id\": 678,\n  \"note\": \"VAT\",\n  \"metadata\": \"{\\\"tax_ref\\\": \\\"too_much\\\"}\",\n}\n</code></pre>"},{"location":"common_usecases/qr_code/#4-qr-code-generation","title":"4. QR Code Generation","text":"<ol> <li>Convert the JSON object to a compact string (e.g., using <code>json.encode</code>).</li> <li>Pass the resulting string to any QR code generator.</li> <li>Display or print the generated QR code as needed.</li> </ol>"},{"location":"common_usecases/signature_verification/","title":"Signature verification","text":"<p>In order to verify that your callback has indeed been called by DeltaPay you must verify the signature that is included in the request. </p> <p>Note: In the future, we will provide libraries for the most common languages to simplify this process. For now, please don't hesitate to contact us for a code snipped in your prefered language.</p>"},{"location":"common_usecases/signature_verification/#python","title":"Python","text":"verify.py<pre><code>from cryptography.hazmat.primitives import hashes\nfrom cryptography.hazmat.primitives.asymmetric import padding, rsa\nfrom cryptography.hazmat.primitives import serialization\nfrom cryptography.hazmat.backends import default_backend\nimport json\nimport base64\n\n# param: public_key_pem: The signing_key linked to the callback\n# param: data: The json data sent as the IPN\ndef verify_signature(public_key_pem: str, data: dict):\n    public_key_pem_bytes = public_key_pem.encode('utf-8')\n    public_key = serialization.load_pem_public_key(public_key_pem_bytes, backend=default_backend())\n\n    # Ensure the public key is of RSA type\n    if not isinstance(public_key, rsa.RSAPublicKey):\n        raise TypeError(\"The provided public key is not an RSA key. Please ensure you are loading an RSA public key.\")\n\n\n    encoded_signature = data.pop(\"signature\")\n    signature = base64.b64decode(encoded_signature)\n    data_to_verify = json.dumps(data, sort_keys=True).encode('utf-8')\n\n    try:\n        public_key.verify(\n            signature,\n            data_to_verify,\n            padding.PSS(\n                mgf=padding.MGF1(hashes.SHA256()),\n                salt_length=padding.PSS.MAX_LENGTH\n            ),\n            hashes.SHA256()\n        )\n        print(\"Signature verification successful.\")\n        return True\n    except Exception as e:\n        print(\"Signature verification failed:\", e)\n        return False\n</code></pre>"},{"location":"common_usecases/signature_verification/#javascript","title":"JavaScript","text":"verify.js<pre><code>const crypto = require('crypto');\n\n// param: public_key_pem: The signing_key linked to the callback\n// param: data: The json data sent as the IPN\nfunction verifySignature(publicKeyPem, data) {\n    // Extract and decode the signature\n    const signature = Buffer.from(data.signature, 'base64');\n    delete data.signature;\n\n    // Sort and construct JSON string matching Python's exact whitespace output\n    const sortedData = Object.keys(data)\n        .sort()\n        .reduce((obj, key) =&gt; {\n            obj[key] = data[key];\n            return obj;\n        }, {});\n\n    const formattedData = '{' + Object.entries(sortedData)\n        .map(([key, value]) =&gt; {\n            const jsonKey = JSON.stringify(key);\n            const jsonValue = value === null ? 'null' : JSON.stringify(value);\n            return `${jsonKey}: ${jsonValue}`;\n        })\n        .join(', ') + '}';\n\n    console.log(\"Serialized data for verification (formatted):\", formattedData);\n\n    // Create verification instance and feed in formatted data\n    const verify = crypto.createVerify('sha256');\n    verify.update(Buffer.from(formattedData, 'utf-8'));\n    verify.end();\n\n    const isVerified = verify.verify(\n        { key: publicKeyPem, padding: crypto.constants.RSA_PKCS1_PSS_PADDING },\n        signature\n    );\n\n    console.log(isVerified ? \"Signature verification successful.\" : \"Signature verification failed.\");\n    return isVerified;\n}\n</code></pre>"},{"location":"common_usecases/signature_verification/#php","title":"PHP","text":""},{"location":"common_usecases/signature_verification/#requirements","title":"Requirements:","text":"<ul> <li>phpseclib v3 installed via Composer (<code>composer require phpseclib/phpseclib:^3.0</code>)</li> <li>ext-json enabled (for <code>json_encode</code>/<code>json_decode</code>)</li> <li>GMP or BCMath PHP extension (php-gmp or php-bcmath)</li> <li>ext-openssl enabled (optional but recommended for performance)</li> <li>PHP 7.2+ (phpseclib3 works on 5.6+, but PSS+SHA-256 is most reliable on 7.2+)</li> <li>A valid RSA public key in PEM format matching the signer\u2019s key</li> </ul> verify.php<pre><code>&lt;?php\n// php_test.php\n\nrequire __DIR__ . '/vendor/autoload.php';\n\nuse phpseclib3\\Crypt\\PublicKeyLoader;\nuse phpseclib3\\Crypt\\RSA;\n\n// 1) Your full callback data, including the signature\n$callbackData = [\n    'transaction_id'                   =&gt; 397,\n    'transaction_type'                 =&gt; 'education',\n    'transaction_status'               =&gt; 'succeeded',\n    'initialisation_time'              =&gt; '2024-10-26T19:07:12.872556',\n    'settled_time'                     =&gt; '2024-10-26T19:07:18.856786',\n    'note'                             =&gt; 'bro',\n    'metadata'                         =&gt; null,\n    'source_of_funds'                  =&gt; '',\n    'bank_account'                     =&gt; null,\n    'sender_account_id'                =&gt; 1014,\n    'sender_account_name'              =&gt; 'New 3',\n    'sender_name'                      =&gt; 'DeltaPay',\n    'sender_till_name'                 =&gt; null,\n    'sender_phone_country_dialcode'    =&gt; null,\n    'sender_phone_number'              =&gt; null,\n    'recipient_account_id'             =&gt; 1001,\n    'recipient_account_name'           =&gt; 'Personal',\n    'recipient_name'                   =&gt; 'adrian',\n    'recipient_till_name'              =&gt; null,\n    'recipient_phone_country_dialcode' =&gt; null,\n    'recipient_phone_number'           =&gt; null,\n    'amount'                           =&gt; 7,\n    'cashback_received'                =&gt; 0,\n    'cashback_spent'                   =&gt; 0,\n    'fee'                              =&gt; 0,\n    'commission_amount'                =&gt; 0,\n    'signature'                        =&gt; 'aY59ZtcOebh8tPrHACHrAhE7k0IoLvXha5I7jPdNj1niSSktaXScmI6mOUztFEk5LEYSUiYyDYvAK/qqt4c4hLYX5KjSZR1IuA7y9mlLn4O/WFyqTQ7vweKqFuQrpptpMhxupf7Jb9JI/dr02+txGF0BgA8q/4C9cqJIGiN8wncMuMUm0rg7DGRxwEWbc5Odn9IRyGQA3j3cU0uPDQZ0z12ucFs5AtspfsrBFdbKsV66eb1PSHSGUe0AF2cIZEqk7r5JwU4EAQCLYoShrg6J2NZdzlVXCFZk2+l20LXSCdH9pR6ZDvBSOLUhpwavHfDs27IEvtasMxvXx7B1OEHBoA=='\n];\n\n// 2) Your RSA public key\n$publicKeyPem = &lt;&lt;&lt;'KEY'\n-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAw4iXQZfRMpjTOOgLEaBl\nxmYvbE8RbbfUq6ROQUrzTE1+QkAwZCL8VDdBenaNXrndjBK+2hh9sA5hQGzqlCgY\nMRvkaDtLUuHyo5YFSfJ8z4WHMoS6/B/t9rc+56I05tDabcMgPYAU4V9M1jYZ7Aie\nLfLQfKwA96EewBPoGMJaespF4NVMh/UmOkzIj3uidueiZjG9ef7vYJrha7Y7f6x4\nJjA7Dt5eh9SzF8ck9fsIjca/e/KwJhKlRZ+tMnkFSU/b4Sds90pGl1Inneqp1oHs\na/PpV9BYM8rvEQdvs6ifObLIOCPw+zQdcFKW/FbPWq016ZVMy0iT+Lmh7sB5bORk\n2wIDAQAB\n-----END PUBLIC KEY-----\nKEY;\n\n// --- extract &amp; decode the signature ---\nif (!isset($callbackData['signature'])) {\n    echo \"? signature field missing\\n\";\n    exit(1);\n}\n$sigB64    = $callbackData['signature'];\nunset($callbackData['signature']);\n$signature = base64_decode($sigB64);\n\n// --- sort keys like Python sort_keys=True ---\nksort($callbackData);\n\n// --- build the JSON payload with \u201c, \u201d and \u201c: \u201d separators ---\n$parts = [];\nforeach ($callbackData as $k =&gt; $v) {\n    $jsonKey   = json_encode($k, JSON_UNESCAPED_UNICODE);\n    $jsonValue = $v === null\n        ? 'null'\n        : json_encode($v, JSON_UNESCAPED_UNICODE | JSON_UNESCAPED_SLASHES);\n    $parts[] = \"{$jsonKey}: {$jsonValue}\";\n}\n$payload = '{' . implode(', ', $parts) . '}';\n\n// Show it\necho \"Serialized data for verification:\\n{$payload}\\n\\n\";\n\n// --- load key &amp; configure PSS+SHA256 ---\n$key = PublicKeyLoader::load($publicKeyPem)\n    -&gt;withHash('sha256')\n    -&gt;withMGFHash('sha256')\n    -&gt;withPadding(RSA::SIGNATURE_PSS);\n\n// compute Python\u2019s MAX_LENGTH salt (keyBytes - hashLen - 2)\n$keyBits  = $key-&gt;getLength();                   // e.g. 2048\n$keyBytes = intdiv($keyBits, 8);                 // e.g. 256\n$hashLen  = strlen(hash('sha256', '', true));    // 32\n$saltLen  = $keyBytes - $hashLen - 2;            // 256-32-2 = 222\n\n// apply it\n$rsa = $key-&gt;withSaltLength($saltLen);\n\n// verify\nif ($rsa-&gt;verify($payload, $signature)) {\n    echo \"? Signature verification successful.\\n\";\n    exit(0);\n} else {\n    echo \"? Signature verification failed.\\n\";\n    exit(1);\n}\n</code></pre>"},{"location":"common_usecases/signature_verification/#c","title":"C#","text":""},{"location":"common_usecases/signature_verification/#requirements_1","title":"Requirements:","text":"<ul> <li>.NET 6.0 SDK (or later)</li> <li>BouncyCastle.NetCore installed via NuGet</li> <li>System.Text.Json (Included in .NET Core 3.0+; used for key/value serialization.)</li> </ul> <pre><code>using System.Text;\nusing System.Text.Json;\nusing Org.BouncyCastle.Crypto;\nusing Org.BouncyCastle.Crypto.Digests;\nusing Org.BouncyCastle.Crypto.Engines;\nusing Org.BouncyCastle.Crypto.Parameters;\nusing Org.BouncyCastle.Crypto.Signers;\nusing Org.BouncyCastle.OpenSsl;\n\nclass Program\n{\n    static int Main()\n    {\n        // 1) Build your callback data dictionary, signature last\n        var callbackData = new Dictionary&lt;string, object&gt;\n        {\n            [\"transaction_id\"] = 397,\n            [\"transaction_type\"] = \"education\",\n            [\"transaction_status\"] = \"succeeded\",\n            [\"initialisation_time\"] = \"2024-10-26T19:07:12.872556\",\n            [\"settled_time\"] = \"2024-10-26T19:07:18.856786\",\n            [\"note\"] = \"bro\",\n            [\"metadata\"] = null,\n            [\"source_of_funds\"] = \"\",\n            [\"bank_account\"] = null,\n            [\"sender_account_id\"] = 1014,\n            [\"sender_account_name\"] = \"New 3\",\n            [\"sender_name\"] = \"DeltaPay\",\n            [\"sender_till_name\"] = null,\n            [\"sender_phone_country_dialcode\"] = null,\n            [\"sender_phone_number\"] = null,\n            [\"recipient_account_id\"] = 1001,\n            [\"recipient_account_name\"] = \"Personal\",\n            [\"recipient_name\"] = \"adrian\",\n            [\"recipient_till_name\"] = null,\n            [\"recipient_phone_country_dialcode\"] = null,\n            [\"recipient_phone_number\"] = null,\n            [\"amount\"] = 7,\n            [\"cashback_received\"] = 0,\n            [\"cashback_spent\"] = 0,\n            [\"fee\"] = 0,\n            [\"commission_amount\"] = 0,\n            // signature must be the *last* key here so we can remove it cleanly\n            [\"signature\"] = \"aY59ZtcOebh8tPrHACHrAhE7k0IoLvXha5I7jPdNj1niSSktaXScmI6mOUztFEk5LEYSUiYyDYvAK/qqt4c4hLYX5KjSZR1IuA7y9mlLn4O/WFyqTQ7vweKqFuQrpptpMhxupf7Jb9JI/dr02+txGF0BgA8q/4C9cqJIGiN8wncMuMUm0rg7DGRxwEWbc5Odn9IRyGQA3j3cU0uPDQZ0z12ucFs5AtspfsrBFdbKsV66eb1PSHSGUe0AF2cIZEqk7r5JwU4EAQCLYoShrg6J2NZdzlVXCFZk2+l20LXSCdH9pR6ZDvBSOLUhpwavHfDs27IEvtasMxvXx7B1OEHBoA==\"\n        };\n\n        // 2) Extract &amp; decode the signature:\n        if (!callbackData.TryGetValue(\"signature\", out var sigObj) || sigObj is not string sigB64)\n        {\n            Console.WriteLine(\"? signature field missing\");\n            return 1;\n        }\n        callbackData.Remove(\"signature\");\n        byte[] signature = Convert.FromBase64String(sigB64);\n\n        // 3) Sort keys lexicographically:\n        var sorted = callbackData.OrderBy(kvp =&gt; kvp.Key, StringComparer.Ordinal);\n\n        // 4) Reassemble JSON with exactly \": \" and \", \":\n        var parts = sorted.Select(kvp =&gt;\n        {\n            string jsonKey = JsonSerializer.Serialize(kvp.Key);\n            string jsonValue = kvp.Value is null\n                ? \"null\"\n                : JsonSerializer.Serialize(kvp.Value);\n            return $\"{jsonKey}: {jsonValue}\";\n        });\n        string payload = \"{\" + string.Join(\", \", parts) + \"}\";\n\n        Console.WriteLine(\"Serialized data for verification:\");\n        Console.WriteLine(payload);\n        Console.WriteLine();\n\n        // 5) Load the RSA public key via BouncyCastle\n        string publicKeyPem = @\"\n-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAw4iXQZfRMpjTOOgLEaBl\nxmYvbE8RbbfUq6ROQUrzTE1+QkAwZCL8VDdBenaNXrndjBK+2hh9sA5hQGzqlCgY\nMRvkaDtLUuHyo5YFSfJ8z4WHMoS6/B/t9rc+56I05tDabcMgPYAU4V9M1jYZ7Aie\nLfLQfKwA96EewBPoGMJaespF4NVMh/UmOkzIj3uidueiZjG9ef7vYJrha7Y7f6x4\nJjA7Dt5eh9SzF8ck9fsIjca/e/KwJhKlRZ+tMnkFSU/b4Sds90pGl1Inneqp1oHs\na/PpV9BYM8rvEQdvs6ifObLIOCPw+zQdcFKW/FbPWq016ZVMy0iT+Lmh7sB5bORk\n2wIDAQAB\n-----END PUBLIC KEY-----\";\n\n        AsymmetricKeyParameter bcPub;\n        using (var reader = new System.IO.StringReader(publicKeyPem))\n        {\n            var pem = new PemReader(reader);\n            bcPub = (AsymmetricKeyParameter)pem.ReadObject();\n        }\n\n        // 6) Calculate max salt length = keyBytes - hashLen - 2\n        int keyBits = ((RsaKeyParameters)bcPub).Modulus.BitLength;\n        int keyBytes = keyBits / 8;\n        int hashLen = 32;               // SHA-256 output is 32 bytes\n        int saltLen = keyBytes - hashLen - 2;\n\n        // 7) Configure PSS verifier with max salt\n        var verifier = new PssSigner(\n            new RsaEngine(),\n            new Sha256Digest(),\n            saltLen\n        );\n        verifier.Init(false, bcPub);\n\n        byte[] dataBytes = Encoding.UTF8.GetBytes(payload);\n        verifier.BlockUpdate(dataBytes, 0, dataBytes.Length);\n\n        bool ok = verifier.VerifySignature(signature);\n        Console.WriteLine(ok\n            ? \"Signature verification successful.\"\n            : \"Signature verification failed.\");\n\n        return ok ? 0 : 1;\n    }\n}\n</code></pre>"},{"location":"getting_started/authentication/","title":"Authentication","text":"<p>The API uses three ways of authentication: - OAuth 2.0 token - API Key - Blockchain transaction signatures</p> <p>The OAuth 2.0 token and API Key can largely be used interchangeably, whereas functions that entail state changes on the blockchain will generally have to be signed locally by the client.</p> <p>Note: For the endpoints that allow authentication using both the token and API key, either or the other must be passed.</p>"},{"location":"getting_started/authentication/#oauth-20-token","title":"OAuth 2.0 Token","text":"<p>This form of authentication is designed for individual users. The generated token contains the <code>user_id</code> and can be used to determine the caller without the need to explicitly provide the <code>user_id</code>.</p>"},{"location":"getting_started/authentication/#login-endpoint","title":"Login Endpoint","text":"<p>The <code>POST /login</code> endpoint expects <code>x-www-form-url-encoded</code> data. This is an exception, as all other POST endpoints expect JSON-encoded data.</p> <p>Request Parameters</p> <ul> <li><code>username</code>: <code>string</code></li> <li><code>password</code>: <code>string</code></li> </ul> <p>Example Response <pre><code>{\n  \"token_type\": \"bearer\",\n  \"access_token\": \"eyJraWQiOiI.......\",\n  \"refresh_token\": \"eyJjdHkiOiJK......\",\n  \"user_id\": 1,\n  \"username\": \"adrian\",\n  \"phone_country_dialcode\": \"268\",\n  \"phone_number\": \"24045443\",\n  \"first_name\": \"Adrian Albert\",\n  \"last_name\": \"Koch\"\n}\n</code></pre></p> <p>The login endpoint returns two distinct tokens:</p> <ul> <li><code>access_token</code>: Used to authenticate requests. Generally valid for 15 minutes unless revoked.</li> <li><code>refresh_token</code>: Used to obtain a new access token by calling the <code>POST /refresh-access-token</code> endpoint.</li> </ul>"},{"location":"getting_started/authentication/#usage-example","title":"Usage Example","text":"<p>The <code>access_token</code> must be passed as a bearer token in the API request header. Below is an example call to the <code>GET /user</code> endpoint:</p> <pre><code>curl -X 'GET'\n  'https://api.dev.deltacrypt.net/user'\n  -H 'accept: application/json'\n  -H 'Authorization: Bearer eyJraWQi......'\n</code></pre> <p>Note: The <code>user_id</code> does not need to be explicitly passed, as it can be determined from the token. If a value is provided, it will have precedence.</p>"},{"location":"getting_started/authentication/#api-key","title":"API Key","text":"<p>Authentication using an API token is designed for institutions that want to connect to the API in a programmatic manner. See the API Key Creation section for more detail on how to create and link API tokens.</p> <p>Multiple tokens can be linked to the same legal entity with varying sets of permissions attached to them.</p> <p>The API key must be passed as <code>x-api-key</code> in the API request header. Below is an example call to the <code>GET /user</code> endpoint:</p> <pre><code>curl -X 'GET' \\\n  'https://api.dev.deltacrypt.net/user?user_id=2' \\\n  -H 'accept: application/json' \\\n  -H 'x-api-key: KGD7Wf.....'\n</code></pre> <p>Note: In contrast to the <code>access_token</code> usage, the <code>user_id</code> must be provided in the request as it cannot be determined from the API key.</p>"},{"location":"getting_started/authentication/#authentication-errors","title":"Authentication Errors","text":"<p>Errors that occur in connection with authentication result in the response code 401 (Unauthorized).</p> <p>The error response will provide details on the type of exception, e.g.</p> <pre><code>{\n  \"detail\": \"Token expired\"\n}\n</code></pre> <p>The following exceptions can occur:</p> <ul> <li>Not authorized</li> <li>Username or password incorrect</li> <li>User not confirmed</li> <li>Username not found</li> <li>Could not validate credentials</li> <li>Failed to validate token</li> <li>Invalid API key</li> <li>API key has expired</li> <li>API key has been revoked</li> <li>Provide either a token or an API key, not both</li> <li>Either a token or an API key must be provided</li> </ul> <p>SignUp:</p> <ul> <li>Failed</li> <li>User not found</li> <li>Username not found</li> <li>User already registered</li> <li>Username already in use</li> <li>Password does not meet the requirements</li> <li>Confirmation code is incorrect</li> <li>Confirmation code has expired</li> <li>Attempt limit exceeded</li> </ul> <p>Login:</p> <ul> <li>Failed</li> <li>Another challenge is required</li> <li>Username not found in the database</li> </ul> <p>Refresh Access Token: Failed</p> <p>Forgot Password:</p> <ul> <li>Failed</li> <li>Username not found</li> <li>Attempt limit exceeded</li> <li>Confirmation code is incorrect</li> <li>Confirmation code has expired</li> <li>Too many failed attempts</li> <li>Password does not meet the requirements</li> </ul> <p>Change Password:</p> <ul> <li>Failed</li> <li>Password does not meet the requirements</li> <li>Attempt limit exceeded</li> </ul> <p>Change Phone Number:</p> <ul> <li>Failed</li> <li>Code is incorrect</li> <li>Code has expired</li> <li>Attempt limit exceeded</li> </ul> <p>Another common cause for an endpoint to return 401 (Unauthorized) is missing permissions, e.g.</p> <pre><code>{\n  \"detail\": \"API key does not have the required permission: view_kyc_data (target_user_id: 2)\"\n}\n</code></pre>"},{"location":"getting_started/authentication/#blockchain-transaction-signatures","title":"Blockchain Transaction Signatures","text":"<p>The interaction with the blockchain follows three simple steps:</p> <ol> <li>Obtain the raw blockchain transaction (generally using one of the GET endpoints prefixed with raw).</li> <li>Sign the transaction locally using the Ethereum wallet previously generated.</li> <li>Optionally query the state of the blockchain transaction.</li> </ol> <p>For more details on specific endpoints, please refer to the example attached to this document or contact DeltaPay directly.</p> <p>For the transaction to succeed, the wallet used to sign it must be whitelisted on the blockchain. This requires the caller to provide the public wallet address of the wallet they want to link to the API-key-account (or user-account) pair, which happens implicitly in one of the following ways:</p> <ul> <li><code>POST /account/link-api-key</code></li> <li><code>POST /account/create-personal</code></li> <li><code>POST /account/register-business</code></li> </ul> <p>For the purpose of this document, we focus on the scenario where API keys are used. For more details on linking an API key to an account, refer to Linking API Key in the setup section.</p> <p>Note: Transactions signed by a wallet linked to an API key differ in some ways from those linked to a user. In particular:</p> <ul> <li>API Keys do not have a spending allowance. Therefore, no transaction initiated by an API key will ever need to be approved.</li> <li>API keys cannot approve other transactions.</li> <li>API keys cannot set spending allowances.</li> <li>API keys cannot deactivate accounts.</li> </ul> <p>Should you require any of the above features, please contact DeltaPay directly.</p>"},{"location":"getting_started/callbacks/","title":"Callbacks","text":"<p>Callbacks are HTTPS endpoints you register to receive asynchronous updates from DeltaPay. Once a callback URL is registered for an account, DeltaPay automatically sends updates for all relevant events related to that account.</p> <p>Currently, there are two types of callbacks:</p> <ol> <li>Instant Payment Notification (IPN)</li> <li>Payment Request Status Updates</li> </ol> <p>There is no separate opt-in or opt-out mechanism for specific callback types. Once a callback is registered, both IPNs and Payment Request Updates will be sent as they occur. You can choose to ignore those you do not need.</p> <p>Each registered callback URL must be verified using its public key, which DeltaPay provides upon registration. Different accounts require separate callback registrations and therefore separate key pairs \u2014 even if the actual callback URL is the same. The public key used to verify both IPN and Payment Request callbacks is the same for a given registration.</p> <p>All callbacks are sent at least once, meaning duplicates are possible.</p> <p>Note: Callback retries are not yet implemented. In future versions, DeltaPay will automatically retry failed deliveries up to three times if no valid acknowledgment is received.</p>"},{"location":"getting_started/callbacks/#callback-registration-and-management","title":"Callback Registration and Management","text":"<p>Users can register callbacks for a number of events that occur on the DeltaPay system. To ensure easy extensibility, only the base URL is registered \u2014 DeltaPay automatically appends the relevant sub-path for each callback type.</p> <p>For example, if the callback endpoint is:</p> <pre><code>https://api.client.co.sz\n</code></pre> <p>then:</p> <ul> <li>the IPN callback will be sent to <code>POST https://api.client.co.sz/transaction/ipn</code></li> <li>the Payment Request update callback will be sent to <code>POST https://api.client.co.sz/payment-request/update</code></li> </ul>"},{"location":"getting_started/callbacks/#account-linkage-and-manager-legal-entity","title":"Account linkage and manager legal entity","text":"<p>Callbacks are registered for a specific account. Any events pertaining to this account \u2014 such as transaction updates or payment request changes \u2014 are then communicated via the callback.</p> <p>In some cases, a third party (e.g. an e-commerce platform or payment aggregator) may need to receive callbacks for accounts they do not directly own. To support this, the registration includes a <code>manager_entity_id</code>, representing the legal entity managing the callback configuration.</p> <p>This allows, for example, a marketplace platform to register and manage callbacks on behalf of merchants, while maintaining clear separation of permissions.</p> <p>When retrieving callbacks registered for a specific account, the <code>view_callback_url</code> permission for the manager entity is sufficient if provided.</p>"},{"location":"getting_started/callbacks/#register-callback","title":"Register callback","text":"<p><code>POST /account/callback-url/register</code></p> <ol> <li>Registers the callback for the specified account.</li> <li>Generates a new signing key pair. The public key is returned and must be used to verify callback signatures.</li> </ol> <p>Request Parameters</p> <ul> <li><code>callback_url</code>: string \u2014 The base URL to which DeltaPay will send callbacks</li> <li><code>account_id</code>: int \u2014 The account for which the callback applies</li> <li><code>manager_entity_id</code>: int \u2014 The legal entity responsible for managing the callback</li> </ul> <p>Required Permissions</p> <p>The caller must have the <code>set_callback_url</code> permission, either generally or specifically for the account and manager legal entity that the callback URL is set for.</p> <p>Example Response</p> <pre><code>{\n  \"callback_id\": 4,\n  \"callback_url\": \"https://api.dev.deltacrypt.net\",\n  \"account_id\": 1004,\n  \"manager_entity_id\": 1,\n  \"signing_key\": \"-----BEGIN PUBLIC KEY-----\\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA57xXfRBtvwwotZBjW+zW\\n7GzPchUlgzqJL5epFKL15E0gqgIu7O1fvnohpBdHe2uEAlGhJWw/LUsAKrYQECau\\nm6gBEC6TWMzG8ne8yU5QH2lLq4J4BL4slHTSN//t7vejZu02N33STZP5CoS0bJ5f\\nImk4s69jp5vjesUussFqBmVUHbEYn3D+Ihz/Hbrwx61EC0hRwBcTTYHCXgDEey3P\\n0dztvs+WKP00qiUg8Eb16kaooA1/fI3ZaW94QnYYfH9UKspiJWtUfapdNExv1utD\\ndOHZhdkbbtX8/JG3LZIyjUGrnxfDu0wC5RKWltBzKjzHn/b0Ai7xrElWfgjmRPtZ\\nwQIDAQAB\\n-----END PUBLIC KEY-----\\n\",\n  \"active\": true,\n  \"deactivation_time\": null\n}\n</code></pre>"},{"location":"getting_started/callbacks/#getting-callbacks-registered-for-an-account","title":"Getting callbacks registered for an account","text":"<p><code>GET /account/callback-urls</code></p> <p>Request Parameters</p> <ul> <li><code>account_id</code>: int \u2014 The account whose registered callbacks should be returned</li> <li><code>manager_entity_id</code>: Optional[int] \u2014 Optionally filter by managing entity</li> </ul> <p>Required Permissions</p> <p>The caller must have the <code>view_callback_url</code> permission, either generally or specifically for the account and manager legal entity.</p> <p>Example Response</p> <pre><code>{\n  \"callback_urls\": [\n    {\n      \"callback_id\": 4,\n      \"callback_url\": \"https://api.dev.deltacrypt.net\",\n      \"account_id\": 42,\n      \"manager_entity_id\": 1,\n      \"signing_key\": \"-----BEGIN PUBLIC KEY-----\\n...\\n-----END PUBLIC KEY-----\\n\",\n      \"active\": true,\n      \"deactivation_time\": null\n    },\n    {\n      \"callback_id\": 1,\n      \"callback_url\": \"test\",\n      \"account_id\": 14,\n      \"manager_entity_id\": 1,\n      \"signing_key\": \"-----BEGIN PUBLIC KEY-----\\n...\\n-----END PUBLIC KEY-----\\n\",\n      \"active\": false,\n      \"deactivation_time\": \"2024-10-26T14:54:21.178337\"\n    }\n  ]\n}\n</code></pre>"},{"location":"getting_started/callbacks/#deactivate-callback","title":"Deactivate callback","text":"<p><code>DELETE /account/callback-url/deactivate</code></p> <p>Sets the callback URL to inactive, preventing further callbacks for events related to this account.</p> <p>Request Parameters</p> <ul> <li><code>callback_id</code>: int</li> </ul> <p>Required Permissions</p> <p>The caller must have the <code>set_callback_url</code> permission, either generally or specifically for the account and manager legal entity.</p>"},{"location":"getting_started/callbacks/#verifying-callbacks","title":"Verifying callbacks","text":"<p>To ensure the callback is authentic and has been sent by DeltaPay, you must verify the <code>signature</code> attribute included in each callback payload. For code examples in common programming languages, see Signature Verification.</p>"},{"location":"getting_started/callbacks/#acknowledging-callbacks","title":"Acknowledging callbacks","text":"<p>To confirm that your system has successfully received and processed a callback, your endpoint must return an HTTP 200 OK response.</p> <p>If DeltaPay does not receive a <code>200</code> response (e.g. the request times out, returns another status code, or cannot be delivered), the callback will be retried up to three times with exponential backoff.</p> <p>After three failed attempts, the callback is considered undeliverable, and no further retries will be attempted. There is currently no manual retry feature.</p> <p>Example of a valid acknowledgment response:</p> <pre><code>HTTP/1.1 200 OK\nContent-Type: application/json\n\n{\"status\": \"received\"}\n</code></pre> <p>Tip: You should return the acknowledgment as quickly as possible. If additional processing is required, handle it asynchronously (e.g. by queuing or background jobs) to avoid blocking the callback.</p>"},{"location":"getting_started/permissions/","title":"Overview","text":"<p>The permissions for accessing non-blockchain functions are organized as follows:</p> <ul> <li>General Permissions: These apply broadly across the system.</li> <li>Targeted Permissions: These apply to specific targets, in particular:<ul> <li>User</li> <li>Account</li> <li>Legal Entity</li> </ul> </li> </ul> <p>Note: No permissions are needed when a <code>UserTargetPermission</code> is required and the caller is the target user. This allows users to request their own data without requiring specific permissions. Any exceptions to this rule will be clearly stated.</p>"},{"location":"getting_started/permissions/#roles","title":"Roles","text":"<p>General permissions can be attached to a role, which may then be assigned to a user or API key. This allows for logical grouping of permissions and avoids having to assign them individually.</p> <p>Note: Permissions assigned to a role are always general (they do not apply to a specific target).</p>"},{"location":"getting_started/permissions/#user-and-api-key-permissions","title":"User and API Key Permissions","text":"<p>There are two types of callers:</p> <ul> <li>Users: Who will typically authenticate using an OAuth token.</li> <li>Servers: Which will typically authenticate using an API key.</li> </ul> <p>Both users and API keys can have permissions assigned to them and provide a cognate set of endpoints to grant, view, and revoke roles and permissions respectively. For users there is:</p> <ul> <li><code>POST /user/grant-role</code></li> <li><code>POST /user/grant-account-permissions</code></li> <li><code>POST /user/grant-user-permissions</code></li> <li><code>POST /user/grant-legal-entity-permissions</code></li> <li><code>GET /user/roles</code></li> <li><code>GET /user/permissions</code></li> <li><code>DELETE /user/revoke-role</code></li> <li><code>DELETE /user/revoke-account-permissions</code></li> <li><code>DELETE /user/revoke-user-permissions</code></li> <li><code>DELETE /user/revoke-legal-entity-permissions</code></li> </ul> <p>For API keys there is:</p> <ul> <li><code>POST /api-key/grant-role</code></li> <li><code>POST /api-key/grant-account-permissions</code></li> <li><code>POST /api-key/grant-user-permissions</code></li> <li><code>POST /api-key/grant-legal-entity-permissions</code></li> <li><code>GET /api-key/roles</code></li> <li><code>GET /api-key/permissions</code></li> <li><code>DELETE /api-key/revoke-role</code></li> <li><code>DELETE /api-key/revoke-account-permissions</code></li> <li><code>DELETE /api-key/revoke-user-permissions</code></li> <li><code>DELETE /api-key/revoke-legal-entity-permissions</code></li> </ul> <p>For more detailed documentation on the endpoints above, please refer to the online documentation. For demonstration purposes, we will highlight the following:</p>"},{"location":"getting_started/permissions/#grant-account-permissions","title":"Grant Account Permissions","text":"<p><code>POST /user/grant-account-permissions</code></p> <p>Multiple permissions can be granted for the same user and target account. This is common because, for instance, an account admin gains many permissions simultaneously when assigned the admin role. Different account targets will require separate calls.</p> <p>Note: Granting a permission twice will not throw an error, but simply be ignored.</p> <p>Request Parameters</p> <ul> <li><code>subject_user_id</code>: int</li> <li><code>permissions</code>: Array[string]</li> <li><code>target_account_id</code>: int</li> </ul> <p>Required Permissions</p> <p>The caller must have the general <code>grant_account_permission</code> permission.</p>"},{"location":"getting_started/permissions/#get-users-permissions","title":"Get User's Permissions","text":"<p><code>GET /user/permissions</code></p> <p>Request Parameters</p> <ul> <li><code>user_id: Optional[number]</code></li> </ul> <p>If the <code>user_id</code> is not provided and the caller uses an OAuth token to authenticate the call, it can be determined from the token.</p> <p>Required Permissions</p> <p>The caller must have the <code>view_permissions</code> permission, either generally or specifically for the user. As described at the beginning of the Permissions chapter, users do not need any permissions to view their own data.</p> <p>Example Response <pre><code>{\n    {\n      \"permission\": \"view_spending_allowance\",\n      \"target_type\": \"general\"\n    },\n    ...\n    {\n      \"permission\": \"view_transactions\",\n      \"target_type\": \"general\"\n    },\n    {\n      \"permission\": \"view_account_info\",\n      \"target_type\": \"account_list\",\n      \"target_account_ids\": [\n        1001,\n        1004,\n        1006\n      ]\n    },\n    ...\n</code></pre></p>"},{"location":"getting_started/permissions/#revoke-account-permissions","title":"Revoke Account Permissions","text":"<p><code>DELETE /user/revoke-account-permissions</code></p> <p>This endpoint can be used to revoke either a specific or all permission(s) for a certain user or target account.</p> <p>Request Parameters</p> <ul> <li><code>subject_user_id: number</code></li> <li><code>target_account_id: number</code></li> <li><code>permissions: Optional[string]</code></li> </ul> <p>If permission is null, all permissions are revoked for the target account.</p> <p>Required Permissions</p> <p>The caller must have the general <code>revoke_account_permission</code> permission.</p>"},{"location":"getting_started/setup/","title":"Client Onboarding","text":"<p>The client must be fully onboarded before any API integration can take place. This involves the collection and review of the client's documents as well as the account creation process. Please refer to the DeltaPay terms and conditions for more information. In particular, this process involves the following:</p> <ul> <li>DeltaPay creates the legal entity in the system</li> <li>Client submits a resolution to create the business account(s) and define the AAAs</li> <li>DeltaPay creates and sets up the account(s) as specified in the resolution</li> </ul>"},{"location":"getting_started/setup/#api-key-creation","title":"API Key Creation","text":"<p>Once the client onboarding and account setup are complete, the API keys can be generated. This process can either be completed by the client himself or by DeltaPay on his behalf. The following points are worth considering:</p> <ul> <li> <p>If the client chooses to generate the keys himself, at least one user who is registered with DeltaPay and employed or trusted by the client should be granted the following permissions:</p> </li> <li> <p><code>create_api_key</code></p> </li> <li><code>view_api_keys</code></li> <li><code>revoke_api_key</code></li> </ul> <p>For example, these permissions may be granted to one of the AAAs.</p> <ul> <li>If DeltaPay generates the API key on behalf of the client, the generated key must be shared with the client via traditional channels, such as email, which may not satisfy the client's security requirements.</li> </ul> <p>If the client decides to generate the key(s) himself, he must call the following endpoint:</p>"},{"location":"getting_started/setup/#create-api-key","title":"Create API Key","text":"<p><code>POST /legal-entity/api-key/create</code></p> <p>API keys are valid for five years and can be named to differentiate between them easily. They are attached to the legal entity that was specified when generating them.</p> <p>The generated key is only visible once upon creation; it is the client's responsibility to store and manage it securely.</p> <p>Request Parameters</p> <ul> <li><code>legal_entity_id</code>: int</li> <li><code>name</code>: string</li> </ul> <p>Required Permissions</p> <p>The caller must have the <code>create_api_key</code> permission, either generally or specifically for the targeted legal entity ID.</p> <pre><code>{\n  \"api_key_id\": 4,\n  \"legal_entity_id\": 1,\n  \"prefix\": \"9tsIF\",\n  \"name\": \"test\",\n  \"active\": true,\n  \"creation_time\": \"2024-07-17T17:01:50.837261\",\n  \"expiration_time\": \"2029-07-16T17:01:50.833435\",\n  \"api_key\": \"9tsIFO4XJA-viHR4ga8AW_aixe7mH7IblnB2pNjukYo\"\n}\n</code></pre> <p>After the API key has been created, DeltaPay will grant it permissions based on the client's requirements. Please refer to the Permissions chapter for more information.</p>"},{"location":"getting_started/setup/#get-api-keys","title":"Get API Keys","text":"<p><code>GET /legal-entity/api-keys</code></p> <p>Returns the API keys attached to a legal entity.</p> <p>Request Parameters</p> <ul> <li><code>legal_entity_id</code>: int</li> </ul> <p>Required Permissions</p> <p>The caller must have the <code>view_api_keys</code> permission, either generally or specifically for the targeted legal entity.</p> <pre><code>{\n  \"api_keys\": [\n    {\n      \"api_key_id\": 1,\n      \"legal_entity_id\": 1,\n      \"prefix\": \"OyDH-\",\n      \"name\": \"test\",\n      \"active\": false,\n      \"creation_time\": \"2024-07-12T10:32:30.553105\",\n      \"expiration_time\": \"2029-07-11T10:32:30.543345\"\n    },\n    ...\n    {\n      \"api_key_id\": 4,\n      \"legal_entity_id\": 1,\n      \"prefix\": \"9tsIF\",\n      \"name\": \"test\",\n      \"active\": true,\n      \"creation_time\": \"2024-07-17T17:01:50.837261\",\n      \"expiration_time\": \"2029-07-16T17:01:50.833435\"\n    }\n  ]\n}\n</code></pre> <p>Note how the API key with <code>id</code> 4 we previously created only returns the prefix and name but not the full key.</p>"},{"location":"getting_started/setup/#revoke-api-key","title":"Revoke API Key","text":"<p><code>DELETE legal-entity/api-key/revoke</code></p> <p>API keys can be revoked prior to their expiry date. It is crucial to revoke keys immediately that are suspected to have been leaked. Revoked keys cannot be reactivated.</p> <p>Request Parameters</p> <ul> <li><code>api_key_id</code>: int</li> </ul> <p>Required Permissions</p> <p>The caller must have the <code>revoke_api_key</code> permission, either generally or specifically for the legal entity that the key is linked to.</p>"},{"location":"getting_started/setup/#linking-api-key","title":"Linking API Key","text":"<p>As mentioned in Blockchain Transaction Signatures, the user must link the wallet address and account and either user or API key in order to use for it to be whitelisted on the blockchain.</p> <p>Please refer to the code example for more details on this process.</p> <p>In the case of API keys, this is achieved by calling the following endpoint:</p>"},{"location":"getting_started/setup/#link-api-key","title":"Link API Key","text":"<p><code>POST /account/link-api-key</code></p> <p>If the API key is already linked to the account, calling this endpoint will update the wallet address. This has the same effect as unlinking and relinking with while providing a different wallet address.</p> <p>Request Parameters</p> <ul> <li><code>api_key_id</code>: int</li> <li><code>account_id</code>: int</li> <li><code>wallet_address</code>: string</li> </ul> <p>Required Permissions The caller must have the <code>link_api_key_to_account</code> permission, either generally or specifically for the account that the key is being linked to.</p>"},{"location":"getting_started/setup/#post-accountunlink-api-key","title":"<code>POST /account/unlink-api-key</code>","text":"<p>API keys can be unlinked again. The wallet address that was provided when linking the key will be removed from the whitelist and added to the list of deactivated wallet addresses for the account-API-key pair.</p> <p>Important: Immediately unlink (or update) the API key if there is suspicion that the private key matching the wallet address linked to the account has been leaked. After unlinking the key, the same key can be linked again while providing a different wallet address (of a newly generated wallet). Alternatively, <code>POST /account/link-api-key</code> can be called directly with the new wallet address. This has the same effect as unlinking and relinking.</p> <p>Request Parameters - <code>api_key_id</code>: int - <code>account_id</code>: int</p> <p>Required Permissions The caller must have the <code>unlink_api_key_to_account</code> permission, either generally or specifically for the account that the key is being unlinked from.</p>"},{"location":"getting_started/tills/","title":"Tills","text":""}]}